#!/usr/bin/env bash

set -euo pipefail

if ssh "${LIBVIRT_HOST}" [ -f "${UBUNTU_IMAGE}" ]
then
    diag echo "${UBUNTU_IMAGE}: Already exists"
    exit 0
fi

curl -L "${UBUNTU_IMAGE_URL}" | push-as-root "${UBUNTU_IMAGE}.part"
ssh "${LIBVIRT_HOST}" sudo mv -f "${UBUNTU_IMAGE}.part" "${UBUNTU_IMAGE}"
